(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-48bdbb1d"],{"24d2":function(t,e,n){"use strict";n.d(e,"c",(function(){return i})),n.d(e,"a",(function(){return s})),n.d(e,"b",(function(){return r}));var o=n("f62d"),i=function(t){var e="/api/project";return Object(o["a"])(e,"get",t)},s=function(t){var e="/api/discussion/create";return Object(o["a"])(e,"post",t)},r=function(t,e){var n="/api/discussion/delete";return Object(o["a"])(n,t,e)}},"704c":function(t,e,n){"use strict";n.d(e,"a",(function(){return i})),n.d(e,"b",(function(){return s})),n.d(e,"d",(function(){return r})),n.d(e,"c",(function(){return a}));var o=n("f62d"),i=function(t,e){var n="/api/comment/create";return Object(o["a"])(n,t,e)},s=function(t,e){var n="/api/comment/delete";return Object(o["a"])(n,t,e)},r=function(t){var e="api/recommend";return Object(o["a"])(e,"get",t)},a=function(t,e){var n="/api/tags/page/".concat(e.pindx);return Object(o["a"])(n,t,e)}},8700:function(t,e,n){"use strict";var o=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("div",{staticClass:"row"},[n("card",{style:t.citeStyle,attrs:{bordered:!1,"dis-hover":""}},[n("div",{attrs:{id:t.paperId}},[n("div",{attrs:{slot:"title"},slot:"title"},[t._v("\n      发布者:\n      "),n("a",{attrs:{id:t.id},on:{click:function(e){return e.preventDefault(),t.showUser(e)}}},[t._v(t._s(""===t.creator["username"]?"未知用户":t.creator["username"]))]),n("Modal",{attrs:{"footer-hide":""},model:{value:t.showUserControl,callback:function(e){t.showUserControl=e},expression:"showUserControl"}},[n("Row",[n("i-col",{attrs:{span:"4"}},[n("Avatar",{staticStyle:{width:"100%",height:"100%"},attrs:{src:t.userpic}})],1),n("i-col",{attrs:{span:"10"}},[n("div",{staticClass:"user-name"},[t._v("\n              "+t._s(t.userInfo.username)+"\n            ")]),n("p",{staticStyle:{"margin-top":"5px"}},[t._v(" 邮箱: "+t._s(t.userInfo.email||"暂无邮箱信息")+" ")]),n("p",[t._v(" 所属组织: "+t._s(t.userInfo.institution||"暂无组织信息")+" ")])])],1),n("Divider"),n("Row",[n("i-col",{staticStyle:{"text-align":"center","font-size":"18px"},attrs:{span:"8"}},[n("p",{staticClass:"data-title"},[t._v(" 总发布数 ")]),n("p",[t._v(" "+t._s(t.userInfo.total_post)+" ")])]),n("i-col",{staticStyle:{"text-align":"center","font-size":"18px"},attrs:{span:"8"}},[n("p",{staticClass:"data-title"},[t._v(" 总粉丝数 ")]),n("p",[t._v(" "+t._s(t.userInfo.total_fan)+" ")])]),n("i-col",{staticStyle:{"text-align":"center","font-size":"18px"},attrs:{span:"8"}},[n("p",{staticClass:"data-title"},[t._v(" 总点赞数 ")]),n("p",[t._v(" "+t._s(t.userInfo.total_like)+" ")])])],1),n("Divider"),n("Row",[n("i-col",{attrs:{span:"7",offset:"4"}},[t.userInfo.is_following||this.$store.state.user.userId==t.userInfo.id?this.$store.state.user.userId!=t.userInfo.id?n("i-button",{staticStyle:{width:"100%"},attrs:{type:"primary"},on:{click:t.handleFollow}},[t._v("\n              取消关注\n            ")]):t._e():n("i-button",{staticStyle:{width:"100%"},on:{click:t.handleFollow}},[t._v("\n              关注\n            ")])],1),n("i-col",{attrs:{span:"7",offset:"2"}},[this.$store.state.user.userId!=t.userInfo.id?n("i-button",{staticStyle:{width:"100%"},on:{click:function(e){return t.jumpUserInfo(t.userInfo.id)}}},[t._v("\n              他的主页\n            ")]):t._e()],1)],1)],1)],1),n("p",{attrs:{slot:"extra"},slot:"extra"},[t._v(t._s(1===t.kind?"论文解读":"批注")+"发布于: "+t._s(t.createAt))]),n("Row",[t._v("\n        解读对象: "),n("a",{attrs:{href:t.source}},[t._v(" "+t._s(t.citation)+" ")]),t._v("-------"+t._s(t.publishedYear)+"年\n      ")]),n("Row",[t._v("\n        标题: "+t._s(t.title)+"\n      ")]),n("br"),n("br"),n("br"),n("editor",{domProps:{innerHTML:t._s(t.content)}}),n("br"),n("Row",t._l(t.tags,(function(e,o){return n("Tag",{key:o,staticClass:"sysTopics"},[t._v(t._s(e.name))])})),1)],1),n("br"),0===t.displayType?[n("Row",[n("i-col",{attrs:{span:"12"}},[n("ButtonGroup",[n("i-button",{staticStyle:{"font-size":"14px"},on:{click:t.onLike}},[n("Icon",{attrs:{type:"md-thumbs-up",color:t.likeColor}}),t._v("\n              点赞 "+t._s(t.totalLike)+"\n            ")],1),n("i-button",{staticStyle:{"font-size":"14px"},on:{click:t.onCollect}},[n("Icon",{attrs:{type:t.collectType,color:t.collectColor}}),t._v("\n              收藏 "+t._s(t.totalFavor)+"\n            ")],1),n("i-button",{staticStyle:{"font-size":"14px"},on:{click:t.onComment}},[n("Icon",{attrs:{type:"ios-chatbubbles"}}),t._v("\n              评论 "+t._s(t.totalcomment)+"\n            ")],1),n("br"),n("i-button",{staticStyle:{"font-size":"14px"},on:{click:t.onOut}},[n("Icon",{attrs:{type:"ios-cloud-download"}}),t._v("\n                 导出解读对象\n               ")],1),n("Poptip",{attrs:{confirm:"",title:"确定导出？"},on:{"on-ok":function(e){t.getPdf(),t.onOut4()},"on-cancel":function(e){return t.onOut4()}}},[n("i-button",{staticStyle:{"font-size":"14px"},on:{click:function(e){return t.onOut3()}}},[n("Icon",{attrs:{type:"ios-cloud-download"}}),t._v("\n               导出解读\n              ")],1)],1)],1)],1)],1),t.showComment?n("Card",{staticStyle:{"margin-top":"10px"}},[n("comment",t._b({},"comment",t.comments,!1))],1):t._e()]:1===t.displayType?[n("Button",{staticClass:"cite",attrs:{type:"primary"},on:{click:t.onCite}},[t._v(t._s(t.citeMessage))])]:t._e()],2)],1),n("Divider")],1)},i=[],s=(n("8e6e"),n("456d"),n("bd86")),r=(n("8615"),n("ac6a"),n("96cf"),n("3b8d")),a=(n("a481"),n("c5f6"),n("6c49")),c=n("c24f"),l=n("c276"),u=n("dac0"),p=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[t._l(t.comments,(function(e,o){return n("div",{key:o,staticClass:"author-title reply-father"},[n("Avatar",{staticClass:"header-img",attrs:{size:"default",src:e.headImg}}),n("div",{staticClass:"author-info"},[n("span",{staticClass:"author-name"},[t._v(t._s(e.name))]),n("span",{staticClass:"author-time"},[t._v(t._s(e.time))])]),n("div",{staticClass:"icon-btn"},[n("Button",{on:{click:function(n){return t.showReplyInput(o,e.name,e.id)}}},[n("Icon",{attrs:{type:"ios-chatbubbles"}}),t._v("\n        评论"+t._s("")+"\n      ")],1),e.id===t.myId?n("Poptip",{attrs:{confirm:"",title:"确定要删除吗?删除后将不可恢复。"},on:{"on-ok":function(e){return t.deleteItem(o,t.reply)}}},[n("Button",[n("Icon",{attrs:{type:"ios-trash"}}),t._v("删除\n        ")],1)],1):t._e(),t._e()],1),n("div",{staticClass:"talk-box"},[n("p",[n("span",{staticClass:"reply"},[n("editor",{domProps:{innerHTML:t._s(e.comment)}})],1)])]),n("div",{staticClass:"reply-box"},t._l(e.reply,(function(e,i){return n("div",{key:i,staticClass:"author-title"},[n("Avatar",{staticClass:"header-img",attrs:{size:"default",src:e.headImg}}),n("div",{staticClass:"author-info"},[n("span",{staticClass:"author-name"},[t._v(t._s(e.name))]),n("span",{staticClass:"author-time"},[t._v(t._s(e.time))])]),n("div",{staticClass:"icon-btn"},[n("Button",{on:{click:function(n){return t.showReplyInput(o,e.name,e.id)}}},[n("Icon",{attrs:{type:"ios-chatbubbles"}}),t._v("\n            评论"+t._s("")+"\n          ")],1),n("Poptip",{attrs:{confirm:"",title:"确定要删除吗?删除后将不可恢复。"},on:{"on-ok":function(e){return t.deleteReply(o,i)}}},[e.id===t.myId?n("Button",[n("Icon",{attrs:{type:"ios-trash"}}),t._v("删除\n            ")],1):t._e()],1),t._e()],1),n("div",{staticClass:"talk-box"},[n("p",[n("span",[t._v("回复 "+t._s(e.to)+":")]),n("span",{staticClass:"reply"},[n("span",{staticClass:"reply"},[n("editor",{domProps:{innerHTML:t._s(e.comment)}})],1)])])]),n("div",{staticClass:"reply-box"})],1)})),0),n("div",{directives:[{name:"show",rawName:"v-show",value:t._inputShow(o),expression:"_inputShow(i)"}],staticClass:"my-reply my-comment-reply"},[n("Avatar",{staticClass:"header-img",attrs:{size:"default",src:t.myHeader}}),n("div",{staticClass:"reply-info"},[n("div",{staticClass:"reply-input reply-comment-input",attrs:{tabindex:"0",contenteditable:"true",spellcheck:"false",placeholder:"输入评论..."},on:{input:function(e){return t.onDivInput(e)}}})]),n("div",{staticClass:"reply-btn-box"},[n("Button",{staticClass:"reply-btn",attrs:{type:"primary"},on:{click:function(e){return t.sendCommentReply(o,t.j)}}},[t._v("发表评论")])],1)],1)],1)})),n("div",{directives:[{name:"clickoutside",rawName:"v-clickoutside",value:t.hideReplyBtn,expression:"hideReplyBtn"}],staticClass:"my-reply",on:{click:t.inputFocus}},[n("Avatar",{staticClass:"header-img",attrs:{size:"default",src:t.myHeader}}),n("div",{staticClass:"reply-info"},[n("div",{staticClass:"reply-input",attrs:{tabindex:"0",contenteditable:"true",id:"replyInput",spellcheck:"false",placeholder:"输入评论..."},on:{focus:t.showReplyBtn,input:function(e){return t.onDivInput(e)}}})]),n("div",{directives:[{name:"show",rawName:"v-show",value:t.btnShow,expression:"btnShow"}],staticClass:"reply-btn-box"},[n("Button",{staticClass:"reply-btn",attrs:{type:"primary"},on:{click:t.sendComment}},[t._v("发表评论")])],1)],1)],2)},d=[],m=n("704c"),h=n("24d2"),f={bind:function(t,e,n){function o(n){if(t.contains(n.target))return!1;e.expression&&e.value(n)}t.vueClickOutside=o,document.addEventListener("click",o)},update:function(){},unbind:function(t,e){document.removeEventListener("click",t.vueClickOutside),delete t.vueClickOutside}},y={name:"ArticleComment",components:{editor:u["a"]},props:{myHeader:{type:String,default:"https://ae01.alicdn.com/kf/Hd60a3f7c06fd47ae85624badd32ce54dv.jpg"},myId:{type:Number,default:19870621},comments_init:{type:Array,default:function(){return[]}},interpretation_id:{type:Number,default:0},commentType:{type:Number,default:0}},data:function(){return{btnShow:!1,index:"0",replyComment:"",myName:this.$store.state.user.userName,to:"",toId:-1,comments:this.comments_init}},directives:{clickoutside:f},methods:{ToText:function(t){var e=t;return e.replace(/<(style|script|iframe)[^>]*?>[\s\S]+?<\/\1\s*>/gi,"").replace(/<[^>]+?>/g,"").replace(/\s+/g," ").replace(/ /g," ").replace(/>/g," ")},inputFocus:function(){var t=document.getElementById("replyInput");t.style.padding="8px 8px",t.style.border="2px solid blue",t.focus()},showReplyBtn:function(){this.btnShow=!0},hideReplyBtn:function(){this.btnShow=!1,replyInput.style.padding="10px",replyInput.style.border="none"},showReplyInput:function(t,e,n){console.log(t,e,n),this.comments[this.index].inputShow=!1,this.index=t,this.comments[t].inputShow=!0,this.to=e,this.toId=n},_inputShow:function(t){return this.comments[t].inputShow},deleteItem:function(t){var e=this,n=0===this.commentType?m["b"]:h["b"];n("post",{id:this.comments[t].commentId}).then((function(n){e.comments.splice(t,1),e.$Message.success("删除成功！")})).catch((function(t){console.log(t),e.$Message.success("删除失败!")}))},deleteReply:function(t,e){var n=this,o=0===this.commentType?m["b"]:h["b"];o("post",{id:this.comments[t].reply[e].commentId}).then((function(o){n.comments[t].reply.splice(e,1),n.$Message.success("删除成功！")})).catch((function(t){console.log(t),n.$Message.success("删除失败!")}))},sendComment:function(){var t=this;if(this.replyComment){var e={},n=document.getElementById("replyInput"),o=(new Date).getTime(),i=this.dateStr(o);e.name=this.myName,e.id=this.myId,e.comment=this.replyComment,e.headImg=this.myHeader,e.time=i,e.reply=[],e.commentNum=0,e.like=0,0===this.commentType?Object(m["a"])("post",{interpretation_id:this.interpretation_id,content:e.comment}).then((function(o){t.$Message.success("评论成功!"),console.log(o),e.commentId=o.data.id,t.comments.push(e),t.replyComment="",n.innerHTML=""})).catch((function(e){console.log(e),t.$Message.error("评论失败!")})):Object(h["a"])({topic_id:this.interpretation_id,content:e.comment}).then((function(o){t.$Message.success("评论成功!"),console.log(o),e.commentId=o.data.id,t.comments.push(e),t.replyComment="",n.innerHTML=""})).catch((function(e){console.log(e),t.$Message.error("评论失败!")}))}else this.$message({showClose:!0,type:"warning",message:"评论不能为空"})},sendCommentReply:function(t,e){var n=this;if(this.replyComment){var o={},i=(new Date).getTime(),s=this.dateStr(i);o.name=this.myName,o.to=this.to,o.id=this.myId,o.headImg=this.myHeader,o.comment=this.replyComment,o.time=s,o.commentNum=0,o.like=0,0===this.commentType?Object(m["a"])("post",{interpretation_id:this.interpretation_id,content:o.comment,parent_comment_id:this.comments[t].commentId,to_user_id:this.toId}).then((function(e){n.$Message.success("评论成功!"),console.log(e),o.commentId=e.data.id,n.comments[t].reply.push(o),n.replyComment="",document.getElementsByClassName("reply-comment-input")[t].innerHTML=""})).catch((function(t){console.log(t),n.$Message.error("评论失败!")})):Object(h["a"])({topic_id:this.interpretation_id,content:o.comment,parent_discussion_id:this.comments[t].commentId,to_user_id:this.toId}).then((function(e){n.$Message.success("评论成功!"),console.log(e),o.commentId=e.data.id,n.comments[t].reply.push(o),n.replyComment="",document.getElementsByClassName("reply-comment-input")[t].innerHTML=""})).catch((function(t){console.log(t),n.$Message.error("评论失败!")}))}else this.$message({showClose:!0,type:"warning",message:"评论不能为空"})},onDivInput:function(t){this.replyComment=t.target.innerHTML},dateStr:function(t){var e,n=(new Date).getTime();return n=parseInt((n-t)/1e3),n<600?"刚刚":n<3600&&n>=600?(e=Math.floor(n/60),e+"分钟前"):n<86400&&n>=3600?(e=Math.floor(n/60/60),e+"小时前"):n<2592e3&&n>=86400?(e=Math.floor(n/60/60/24),e+"天前"):(t=new Date(parseInt(t)),t.getFullYear()+"/"+(t.getMonth()+1)+"/"+t.getDate())}}},v=y,b=n("2877"),_=Object(b["a"])(v,p,d,!1,null,null,null),g=_.exports;function w(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function C(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?w(Object(n),!0).forEach((function(e){Object(s["a"])(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):w(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var I={name:"PaperCard",components:{comment:g,editor:u["a"],Editor:u["a"]},props:{id:{type:Number,default:0},creator:{type:Object,default:function(){return{username:"xx",id:"0"}}},title:{type:String,default:"引用"},kind:{type:Number,default:0},citeMessageInit:{type:String,default:"引用"},createAt:{type:String,default:"年/月/日"},content:{type:String,default:"这是一个展示示例"},tags:{type:Array,default:function(){return[]}},isLike:{type:Boolean,default:!1},isCollect:{type:Boolean,default:!1},likeNumber:{type:Number,default:0},commentNumber:{type:Number,default:0},favorNumber:{type:Number,default:0},displayType:{type:Number,default:0},source:{type:String,default:"qq"},citation:{type:String,default:"ss"},publishedYear:{type:Number,default:0},interpretations:{type:Array,default:function(){return[]}},userpic:{type:String,default:"http://116.63.14.146:8000/api/images/default_user_icon.jpg"}},data:function(){return{like:this.$props.isLike,totalLike:this.$props.likeNumber,totalcomment:this.$props.commentNumber,totalFavor:this.$props.favorNumber,collect:this.$props.isCollect,cited:!1,showComment:!1,comments:[],detailController:!1,showUserControl:!1,userInfo:{},htmlTitle:this.title,followText:"",paperid:"1"}},computed:{likeColor:function(){return this.like?"#0084ff":"#747b8b"},paperId:function(){return this.paperid},collectType:function(){return this.collect?"ios-heart":"ios-heart-outline"},collectColor:function(){return this.collect?"#fb7299":"default"},citeStyle:function(){var t="";return t+=this.cite?"margin-left:100px;":"",t+=" word-break: break-all",t},citeMessage:function(){return this.cited?"取消":this.citeMessageInit},popId:function(){return"pop"+this.$props.id},word:function(){return"word-break: break-all"}},methods:{ToText:function(t){var e=t;return e.replace(/<(style|script|iframe)[^>]*?>[\s\S]+?<\/\1\s*>/gi,"").replace(/<[^>]+?>/g,"").replace(/\s+/g," ").replace(/ /g," ").replace(/>/g," ")},onLike:function(){var t=this;this.like=!this.like,this.like?this.totalLike+=1:this.totalLike-=1,Object(a["j"])("post",this.$props.id).then((function(e){var n=t.like?"成功点赞":"成功取消点赞";t.$Message.info(n)})).catch((function(e){t.$Modal.error(Object(l["c"])(e))}))},download:function(){var t=document.createElement("a");t.href="/api/download/Interpretation/".concat(this.id),t.setAttribute("download",this.title),t.click()},onOut:function(){var t=new Blob([this.citation+"  "+this.source],{type:"text/plain;charset=utf-8"});saveAs(t,"解读对象.txt")},onOut3:function(){this.paperid="pdfDom",console.log("1")},onOut4:function(){this.paperid="1",console.log("2")},onCollect:function(){var t=this;this.collect=!this.collect,this.collect?this.totalFavor+=1:this.totalFavor-=1,Object(a["b"])("post",this.$props.id,this.collect?"favor":"unfavor").then((function(e){var n=t.collect?"成功收藏":"成功取消收藏";t.$Message.info(n)})).catch((function(e){t.$Modal.error(Object(l["c"])(e))}))},onComment:function(){var t=Object(r["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.getComments();case 2:this.showComment=!this.showComment;case 3:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),onCite:function(){this.cited=!this.cited,this.$emit("cite-event",{id:this.id,content:this.content,cited:this.cited})},showDetail:function(){var t=this;0===this.evidences.length?Object(a["a"])(this.id,this.kind,"get").then((function(e){t.evidences=e.data.evidences,t.detailController=!0})).catch((function(t){console.log(t)})):this.detailController=!0},convertComments:function(t){console.log(t),t=t.map((function(t){return{commentId:t.id,name:t.username,time:Object(l["e"])(t.created_at),id:t.user_id,comment:t.text,to:t.to_user?t.to_user.username:0,toId:t.to_user?t.to_user.id:"",inputShow:!1,headImg:"http://116.63.14.146:8000/api/"+t.userpic,parent_comment_id:t.parent_comment_id,reply:[]}}));var e={};return t.filter((function(t){return void 0===t.parent_comment_id})).forEach((function(t){e[t.commentId]=t})),t.forEach((function(t){void 0!==t.parent_comment_id&&e[t.parent_comment_id].reply.push(t)})),Object.values(e)},getComments:function(){var t=Object(r["a"])(regeneratorRuntime.mark((function t(){var e,n,o,i,s=this;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e="",n="",o="",t.next=5,Object(c["h"])().then((function(t){n=t.data.id,e=t.data.username,o="http://116.63.14.146:8000/api/"+t.data.userpic})).catch((function(t){s.$Modal.error(Object(l["c"])(t))}));case 5:return i={myName:e,interpretation_id:this.id,myHeader:o,myId:n},t.next=8,Object(a["e"])("get",{interpretation_id:this.id,pindex:1,psize:20}).then((function(t){s.comments=C(C({},i),{},{comments_init:s.convertComments(t.data.comment_list)}),console.log(s.comments)})).catch((function(t){console.log(t),s.comments=i}));case 8:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),showUser:function(){var t=this;Object(c["h"])(this.$props.creator.id).then((function(e){t.showUserControl=!0,t.userInfo=e.data,t.userpic="http://116.63.14.146:8000/api/"+e.data.userpic})).catch((function(e){t.$Modal.error(Object(l["c"])(e))}))},handleFollow:function(){var t=this;this.userInfo.is_following?Object(c["x"])(this.creator.id).then((function(e){t.userInfo.is_following=!1,t.userInfo.total_fan-=1,t.$Message.info("成功取消关注")})).catch((function(e){t.$Modal.error(Object(l["c"])(e))})):Object(c["b"])(this.creator.id).then((function(e){t.userInfo.is_following=!0,t.userInfo.total_fan+=1,t.$Message.info("成功关注")})).catch((function(e){t.$Modal.error(Object(l["c"])(e))}))},jumpUserInfo:function(t){this.$router.push({name:"user_info",params:{id:t}})},getTime:function(t){return Object(l["e"])(t)}}},k=I,O=Object(b["a"])(k,o,i,!1,null,null,null);e["a"]=O.exports}}]);