(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d0ddf70"],{8442:function(e,t,n){"use strict";n.r(t);var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("Card",{attrs:{shadow:""}},[n("div",[n("div",{staticClass:"message-page-con message-category-con"},[n("Menu",{attrs:{width:"auto","active-name":"unread"},on:{"on-select":e.handleSelect}},[n("MenuItem",{attrs:{name:"unread"}},[n("span",{staticClass:"category-title"},[e._v("未读消息")]),n("Badge",{staticStyle:{"margin-left":"10px"},attrs:{count:e.unreadCount}})],1),n("MenuItem",{attrs:{name:"readed"}},[n("span",{staticClass:"category-title"},[e._v("全部消息")]),n("Badge",{staticStyle:{"margin-left":"10px"},attrs:{"class-name":"gray-dadge"}})],1)],1)],1),n("div",{staticClass:"message-page-con message-list-con"},[e.listLoading?n("Spin",{attrs:{fix:"",size:"large"}}):e._e(),n("Menu",{class:e.titleClass,attrs:{width:"auto","active-name":""},on:{"on-select":e.handleView}},[n("Scroll",{attrs:{height:"450"}},e._l(e.messageList,(function(t,a){return n("MenuItem",{key:a,attrs:{name:t.msg_id}},[n("div",[n("p",{staticClass:"msg-title"},[e._v(e._s(t.title))]),n("Badge",{attrs:{status:"default",text:t.create_time}})],1)])})),1),e.hasNext?n("Row",[n("i-col",{staticStyle:{"text-align":"center"}},[n("a",{on:{click:function(t){return t.preventDefault(),e.loadMore(t)}}},[e._v(" 加载更多 ")])])],1):n("Divider",[e._v("暂无更多")])],1)],1),n("div",{staticClass:"message-page-con message-view-con"},[e.contentLoading?n("Spin",{attrs:{fix:"",size:"large"}}):e._e(),n("div",{staticClass:"message-view-header"},[n("h2",{staticClass:"message-view-title"},[e._v(e._s(e.showingMsgItem.title))]),n("time",{staticClass:"message-view-time"},[e._v(e._s(e.showingMsgItem.create_time))])]),n("div",{domProps:{innerHTML:e._s(e.messageContent)}})],1)])])},s=[],r=(n("55dd"),n("75fc")),i=(n("386d"),n("96cf"),n("3b8d")),c=(n("ac6a"),n("5df3"),n("4f7f"),n("c24f")),o={unread:"messageUnreadList",readed:"messageReadedList",trash:"messageTrashList"},u={name:"message_page",data:function(){return{psize:10,pindex:1,listLoading:!1,contentLoading:!1,currentMessageType:"unread",messageContent:"",showingMsgItem:{},unReadHasNext:!0,readedHasNext:!0,readedSet:new Set,messageUnreadList:[],messageReadedList:[]}},computed:{messageList:function(){return this[o[this.currentMessageType]]},titleClass:function(){return{"not-unread-list":"unread"!==this.currentMessageType}},hasNext:function(){return"unread"!==this.currentMessageType?this.readedHasNext:this.unReadHasNext},unreadCount:function(){return this.$store.state.user.unreadCount},only_unread:function(){return"unread"===this.currentMessageType}},methods:{stopLoading:function(e){this[e]=!1},handleSelect:function(e){this.currentMessageType=e},handleView:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.readedSet.has(t)||"unread"!==this.currentMessageType||(this.readedSet.add(t),this.$store.commit("setMessageCount",this.$store.state.user.unreadCount-1)),this.contentLoading=!0,e.next=4,this.convertContent(this.messageList[t]);case 4:this.messageContent=e.sent,this.contentLoading=!1;case 6:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}(),removeMsg:function(e){},convertTitle:function(e){return console.log(e),e.search(/favored/)>=0?"收藏了你的解读！":e.search(/Liked/)>=0?"点赞了你的解读!":e.search(/fan/)>=0?"关注了你!":e.search(/reply/)>=0?"回复了你！":e.search(/Created/)>=0?"创建了一个解读！":"提醒了你"},convertContent:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return console.log(t),n="",e.next=4,Object(c["h"])(t.to_user).then((function(e){n=""===e.data.nickname?e.data.username:e.data.nickname})).catch((function(e){console.log(e)}));case 4:return e.abrupt("return","<a href='/user/user-info/".concat(t.to_user,"'>").concat(n,"</a><p>").concat(this.convertTitle(t.content),"</p>"));case 5:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}(),convertTo:function(e){var t=this;return e.map((function(e,n){return{title:"有一位用户"+t.convertTitle(e.content),creat_time:e.created_at,to_user:parseInt(e.to_user),content:e.content,msg_id:n,loading:!1}}))},loadMore:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){var t,n=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.only_unread||(this.pindex+=1),t=!0,e.abrupt("return",Object(c["f"])({pindex:this.only_unread?1:this.pindex,num_per_page:this.psize,only_unread:this.only_unread}).then((function(e){var a,s=n.convertTo(e.data.page);(a=n.messageList).push.apply(a,Object(r["a"])(s.sort((function(e,t){return new Date(t.create_time)-new Date(e.create_time)})))),t=e.data.has_next,n.only_unread?n.unReadHasNext=t:n.readedHasNext=t})).catch((function(e){console.log(e)})));case 3:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},mounted:function(){var e=this;Object(c["f"])({pindex:this.pindex,num_per_page:this.psize,only_unread:!0}).then((function(t){var n;console.log(t),e.unReadHasNext=t.data.has_next;var a=e.convertTo(t.data.page);(n=e.messageUnreadList).push.apply(n,Object(r["a"])(a.sort((function(e,t){return new Date(t.create_time)-new Date(e.create_time)}))))})).catch((function(e){console.log(e)})),Object(c["f"])({pindex:this.pindex,num_per_page:this.psize}).then((function(t){var n;e.readedHasNext=t.data.has_next;var a=e.convertTo(t.data.page);(n=e.messageReadedList).push.apply(n,Object(r["a"])(a.sort((function(e,t){return new Date(t.create_time)-new Date(e.create_time)}))))})).catch((function(e){console.log(e)}))}},d=u,l=n("2877"),h=Object(l["a"])(d,a,s,!1,null,null,null);t["default"]=h.exports}}]);