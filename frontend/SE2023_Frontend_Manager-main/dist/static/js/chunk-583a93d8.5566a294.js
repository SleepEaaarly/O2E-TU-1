(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-583a93d8"],{"0c0a":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("a-card",{attrs:{bordered:!1}},[a("a-table",{attrs:{"data-source":t.data,columns:t.columns},scopedSlots:t._u([{key:"operation",fn:function(e,s){return[a("div",[a("span",[a("a",{on:{click:function(e){return t.showSystemChat(s)}}},[t._v("回复")]),a("a-modal",{ref:"chatContent",staticClass:"custom-modal",attrs:{title:"客服聊天",width:"750px",footer:"",mask:!0,maskStyle:{opacity:"0.2",background:"#FFFFFF",animation:"none"}},model:{value:t.showDetail,callback:function(e){t.showDetail=e},expression:"showDetail"}},[a("a-card",{staticStyle:{"overflow-y":"scroll",height:"500px"},attrs:{bordered:!1,"dis-hover":""}},t._l(t.selectData.messages,(function(e,s){return t.showDetail?a("span",{key:s},[a("div",{staticClass:"chat-item"},[e.gstime?a("a-row",{staticClass:"system-chat-item"},[t._v(t._s(e.gstime))]):t._e(),"switch_info"==e.type?a("a-row",{staticClass:"system-chat-time",staticStyle:{"font-size":"small"}},[t._v("对方已转换为"+t._s("AI"===e.message?"AI":"人工")+"服务")]):t._e(),"switch_info"!==e.type?a("div",{staticClass:"system-chat-list",class:{"system-chat-me":e.isme}},[e.isme?t._e():a("Image",{attrs:{src:e.userpic,mode:"widthFix","lazy-load":""}}),a("a-row",{staticClass:"system-chat-list-body"},["text"==e.type?a("a-row",[t._v(t._s(e.message))]):t._e(),"img"==e.type?a("a-row",{attrs:{src:e.message,mode:"widthFix","lazy-load":""}}):t._e(),"card"==e.type&&"expert"==e.cardInfo.cardType?a("a-row",[t._v(" [卡片信息]专家名称："+t._s(e.cardInfo.title)),a("br"),t._v(" 专家信息："+t._s(e.cardInfo.info)+" ")]):t._e(),"card"==e.type&&"enterprise"==e.cardInfo.cardType?a("a-row",[t._v(" [卡片信息]企业名称："+t._s(e.cardInfo.title)),a("br"),t._v(" 专家信息："+t._s(e.cardInfo.info)+" ")]):t._e(),"card"==e.type&&"demand"==e.cardInfo.cardType?a("a-row",[t._v(t._s(e.message))]):t._e(),"card"==e.type&&"technique"==e.cardInfo.cardType?a("a-row",[t._v(t._s(e.message))]):t._e(),"report"==e.type?a("a-row",[t._v(t._s(e.message))]):t._e()],1)],1):t._e()],1)]):t._e()})),0),a("a-row",[a("a-col",{attrs:{span:20}},[a("a-textarea",{staticStyle:{"margin-top":"20px",height:"100px"},attrs:{placeholder:"请输入回复，shift+回车换行","auto-size":{minRows:2,maxRows:5}},nativeOn:{keydown:function(e){return t.handleKeyCode(e)}},model:{value:t.reply,callback:function(e){t.reply=e},expression:"reply"}})],1),a("a-col",{attrs:{span:4}},[a("a-button",{staticStyle:{"margin-left":"20px","margin-top":"50px",width:"100px"},attrs:{type:"primary",size:"large"},on:{click:function(e){return t.handleSubmit(t.selectData)}}},[t._v("发送")])],1)],1)],1)],1)])]}},{key:"expandedRowRender",fn:function(e,s){return[a("p",[t._v(t._s(e.description))])]}}])})],1)},n=[],r=a("c7eb"),o=a("1da1"),i=(a("b0c0"),a("14d9"),a("b775")),c=a("7424"),l=function(){var t="".concat(c["BASE_URL_IP"],"/api/system_chat/getAll");return Object(i["f"])(t,i["a"].GET)},d=function(t){var e="".concat(c["BASE_URL_IP"],"/api/system_chat/pushAdmin");return Object(i["f"])(e,i["a"].POST,t)},m=a("cadb"),p=[{title:"姓名",dataIndex:"name",scopedSlots:{customRender:"name"},width:"20%"},{title:"邮箱",dataIndex:"email",scopedSlots:{customRender:"email"},width:"20%"},{title:"时间",dataIndex:"time",scopedSlots:{customRender:"time"},width:"20%"},{title:"最新消息",dataIndex:"message",scopedSlots:{customRender:"message"},width:"25%"},{title:"操作",dataIndex:"operation",scopedSlots:{customRender:"operation"},render:function(){return h("a",["回复"])}}],u={name:"systemChatList",inject:["reload"],components:{},data:function(){return{data:[],columns:p,showDetail:!1,reply:"",selectData:{},style:{contentH:0,itemH:0}}},mounted:function(){this.init(),this.pageToBottom()},onload:function(){this.init()},updated:function(){this.pageToBottom()},methods:{init:function(){var t=Object(o["a"])(Object(r["a"])().mark((function t(){return Object(r["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:this.loadAllChat();case 1:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),initdata:function(){var t=this;return Object(o["a"])(Object(r["a"])().mark((function e(){var a,s;return Object(r["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:try{a=window.innerHeight,s=200,t.style.contentH=a-2*s}catch(n){}case 1:case"end":return e.stop()}}),e)})))()},pageToBottom:function(){},loadAllChat:function(){var t=this;l().then((function(e){for(var a=0;a<e.data.system_chat_list.length;a++){var s=e.data.system_chat_list[a],n={messages:[]};n.uId=s.userInfo.uId,n.email=s.userInfo.email,n.name=s.userInfo.name;for(var r=null,o=null,i=0;i<s.messages.length;i++){var c=s.messages[i],l={};l.isme=c.isme,l.userpic=c.userpic,l.type=c.type,"report"===c.type?"WORK"===c.reportInfo.reportType?l.message="[成果报告卡片]主题是："+c.reportInfo.reportTitle+"\n详情请在移动端查看":"NEED"===c.reportInfo.reportType?l.message="[需求报告卡片]主题是："+c.reportInfo.reportTitle+"\n详情请在移动端查看":"ORDER"===c.reportInfo.reportType&&(l.message="[订单报告卡片]主题是："+c.reportInfo.reportTitle+"\n详情请在移动端查看"):l.message=c.message,l.cardInfo=c.cardInfo,l.created_at=c.created_at,null===r?(l.gstime=m["a"].gettime(c.created_at,0),r=c.created_at):(l.gstime=m["a"].gettime(c.created_at,r),r=c.created_at),n.messages.push(l),o=l.message}n.time=r,n.message=o,t.data.push(n)}})).catch((function(t){}))},handleSubmit:function(t){var e=this,a=this.reply;d({uId:this.selectData.uId,content:this.reply}).then((function(t){var s=(new Date).getTime(),n={isme:!0,userpic:"",type:"text",message:a,gstime:m["a"].gettime(s,e.selectData.messages[e.selectData.messages.length-1].created_at),created_at:s};e.selectData.messages.push(n)})).catch((function(t){})),this.reply=""},showSystemChat:function(t){this.showDetail=!0,this.selectData=t},handleKeyCode:function(t){13==t.keyCode&&(t.shiftKey?(this.reply=this.reply+"\n",t.preventDefault()):(t.preventDefault(),this.handleSubmit(this.reply)))}}},f=u,y=(a("6d939"),a("2877")),_=Object(y["a"])(f,s,n,!1,null,null,null);e["default"]=_.exports},"6d939":function(t,e,a){"use strict";a("cd5d")},cd5d:function(t,e,a){}}]);