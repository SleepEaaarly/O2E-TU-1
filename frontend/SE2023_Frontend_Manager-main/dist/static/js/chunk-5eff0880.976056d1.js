(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-5eff0880"],{"0c0a":function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("a-card",{attrs:{bordered:!1}},[a("a-table",{attrs:{"data-source":e.data,columns:e.columns},scopedSlots:e._u([{key:"operation",fn:function(t,s){return[a("div",[a("span",[a("a",{on:{click:function(t){return e.showSystemChat(s)}}},[e._v("回复")]),a("a-modal",{ref:"chatContent",attrs:{title:"客服聊天",width:"750px",footer:""},model:{value:e.showDetail,callback:function(t){e.showDetail=t},expression:"showDetail"}},[a("a-card",{staticStyle:{"overflow-y":"scroll",height:"600px"},attrs:{bordered:!1,"dis-hover":""}},e._l(e.selectData.messages,(function(t,s){return e.showDetail?a("span",{key:s},[a("div",{staticClass:"chat-item"},[t.gstime?a("a-row",{staticClass:"system-chat-item"},[e._v(e._s(t.gstime))]):e._e(),"switch_info"==t.type?a("a-row",{staticClass:"system-chat-time"},[e._v("对方已转换为"+e._s(t.message)+"服务")]):e._e(),"switch_info"!==t.type?a("div",{staticClass:"system-chat-list",class:{"system-chat-me":t.isme}},[t.isme?e._e():a("Image",{attrs:{src:t.userpic,mode:"widthFix","lazy-load":""}}),a("a-row",{staticClass:"system-chat-list-body"},["text"==t.type?a("a-row",[e._v(e._s(t.message))]):e._e(),"img"==t.type?a("a-row",{attrs:{src:t.message,mode:"widthFix","lazy-load":""}}):e._e(),"card"==t.type&&"expert"==t.cardInfo.cardType?a("a-row",[e._v(" [卡片信息]专家名称："+e._s(t.cardInfo.title)),a("br"),e._v(" 专家信息："+e._s(t.cardInfo.info)+" ")]):e._e(),"card"==t.type&&"enterprise"==t.cardInfo.cardType?a("a-row",[e._v(" [卡片信息]企业名称："+e._s(t.cardInfo.title)),a("br"),e._v(" 专家信息："+e._s(t.cardInfo.info)+" ")]):e._e(),"card"==t.type&&"demand"==t.cardInfo.cardType?a("a-row",[e._v(e._s(t.message))]):e._e(),"card"==t.type&&"technique"==t.cardInfo.cardType?a("a-row",[e._v(e._s(t.message))]):e._e(),"report"==t.type&&"work"==t.reportInfo.reportType?a("a-row",[e._v(e._s(t.message))]):e._e(),"report"==t.type&&"need"==t.reportInfo.reportType?a("a-row",[e._v(e._s(t.message))]):e._e(),"report"==t.type&&"order"==t.reportInfo.reportType?a("a-row",[e._v(e._s(t.message))]):e._e()],1)],1):e._e()],1)]):e._e()})),0),a("a-card",[a("a-row",[a("a-col",{attrs:{span:20}},[a("a-textarea",{attrs:{placeholder:"请输入回复，shift+回车换行","auto-size":{minRows:2,maxRows:5}},nativeOn:{keydown:function(t){return e.handleKeyCode(t)}},model:{value:e.reply,callback:function(t){e.reply=t},expression:"reply"}})],1),a("a-col",{attrs:{span:4}},[a("a-button",{on:{click:function(t){return e.handleSubmit(e.selectData)}}},[e._v("发送")])],1)],1)],1)],1)],1)])]}},{key:"expandedRowRender",fn:function(t,s){return[a("p",[e._v(e._s(t.description))])]}}])})],1)},n=[],r=a("c7eb"),o=a("1da1"),i=(a("b0c0"),a("14d9"),a("b775")),c=a("7424"),d=function(){var e="".concat(c["BASE_URL_IP"],"/api/system_chat/getAll");return Object(i["f"])(e,i["a"].GET)},l=function(e){var t="".concat(c["BASE_URL_IP"],"/api/system_chat/pushAdmin");return Object(i["f"])(t,i["a"].POST,e)},u=a("cadb"),m=[{title:"姓名",dataIndex:"name",scopedSlots:{customRender:"name"},width:100},{title:"邮箱",dataIndex:"email",scopedSlots:{customRender:"email"},width:150},{title:"时间",dataIndex:"time",scopedSlots:{customRender:"time"},width:150},{title:"最新消息",dataIndex:"message",scopedSlots:{customRender:"message"},width:150},{title:"操作",dataIndex:"operation",scopedSlots:{customRender:"operation"},width:150,render:function(){return h("a",["回复"])}}],p={name:"systemChatList",inject:["reload"],components:{},data:function(){return{data:[],columns:m,showDetail:!1,reply:"",selectData:{},style:{contentH:0,itemH:0}}},mounted:function(){this.init(),this.pageToBottom()},onload:function(){this.init()},updated:function(){this.pageToBottom()},methods:{init:function(){var e=Object(o["a"])(Object(r["a"])().mark((function e(){return Object(r["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:this.loadAllChat();case 1:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),initdata:function(){var e=this;return Object(o["a"])(Object(r["a"])().mark((function t(){var a,s;return Object(r["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:try{a=window.innerHeight,s=200,e.style.contentH=a-2*s}catch(n){}case 1:case"end":return t.stop()}}),t)})))()},pageToBottom:function(){},loadAllChat:function(){var e=this;d().then((function(t){for(var a=0;a<t.data.system_chat_list.length;a++){var s=t.data.system_chat_list[a],n={messages:[]};n.uId=s.userInfo.uId,n.email=s.userInfo.email,n.name=s.userInfo.name;for(var r=null,o=null,i=0;i<s.messages.length;i++){var c=s.messages[i],d={};d.isme=c.isme,d.userpic=c.userpic,d.type=c.type,d.message=c.message,d.cardInfo=c.cardInfo,d.created_at=c.created_at,null===r?(d.gstime=u["a"].gettime(c.created_at,0),r=c.created_at):(d.gstime=u["a"].gettime(c.created_at,r),r=c.created_at),n.messages.push(d),o=d.message}n.time=r,n.message=o,e.data.push(n)}})).catch((function(e){}))},handleSubmit:function(e){var t=this;l({uId:this.selectData.uId,content:this.reply}).then((function(a){var s=(new Date).getTime(),n={isme:!1,userpic:"",type:"text",message:t.reply,gstime:u["a"].gettime(s,e.messages[e.messages.length-1].created_at),created_at:s};e.messages.push(n)})).catch((function(e){})),this.reply=""},showSystemChat:function(e){this.showDetail=!0,this.selectData=e},handleKeyCode:function(e){13==e.keyCode&&(e.shiftKey?(this.reply=this.reply+"\n",e.preventDefault()):(e.preventDefault(),this.handleSubmit(this.reply)))}}},f=p,_=(a("5fc8"),a("2877")),y=Object(_["a"])(f,s,n,!1,null,null,null);t["default"]=y.exports},"11bc":function(e,t,a){},"5fc8":function(e,t,a){"use strict";a("11bc")}}]);