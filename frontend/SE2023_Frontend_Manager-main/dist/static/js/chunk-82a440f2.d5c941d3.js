(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-82a440f2"],{"0c0a":function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("a-card",{attrs:{bordered:!1}},[a("a-table",{attrs:{"data-source":e.data,columns:e.columns},scopedSlots:e._u([{key:"operation",fn:function(t,s){return[a("div",[a("span",[a("a",{on:{click:function(t){return e.showSystemChat(s)}}},[e._v("回复")]),a("a-modal",{ref:"chatContent",staticClass:"custom-modal",attrs:{title:"客服聊天",width:"750px",footer:"",mask:!0,maskStyle:{opacity:"0.08",background:"#000000",animation:"none"}},model:{value:e.showDetail,callback:function(t){e.showDetail=t},expression:"showDetail"}},[a("a-card",{staticStyle:{"overflow-y":"scroll",height:"500px"},attrs:{bordered:!1,"dis-hover":""}},e._l(e.selectData.messages,(function(t,s){return e.showDetail?a("span",{key:s},[a("div",{staticClass:"chat-item"},[t.gstime?a("a-row",{staticClass:"system-chat-item"},[e._v(e._s(t.gstime))]):e._e(),"switch_info"==t.type?a("a-row",{staticClass:"system-chat-time",staticStyle:{"font-size":"small"}},[e._v("对方已转换为"+e._s("AI"===t.message?"AI":"人工")+"服务")]):e._e(),"switch_info"!==t.type?a("div",{staticClass:"system-chat-list",class:{"system-chat-me":t.isme}},[t.isme?e._e():a("Image",{attrs:{src:t.userpic,mode:"widthFix","lazy-load":""}}),a("a-row",{staticClass:"system-chat-list-body"},["text"==t.type?a("a-row",[e._v(e._s(t.message))]):e._e(),"img"==t.type?a("a-row",{attrs:{src:t.message,mode:"widthFix","lazy-load":""}}):e._e(),"card"==t.type&&"expert"==t.cardInfo.cardType?a("a-row",[e._v(" [卡片信息]专家名称："+e._s(t.cardInfo.title)),a("br"),e._v(" 专家信息："+e._s(t.cardInfo.info)+" ")]):e._e(),"card"==t.type&&"enterprise"==t.cardInfo.cardType?a("a-row",[e._v(" [卡片信息]企业名称："+e._s(t.cardInfo.title)),a("br"),e._v(" 专家信息："+e._s(t.cardInfo.info)+" ")]):e._e(),"card"==t.type&&"demand"==t.cardInfo.cardType?a("a-row",[e._v(e._s(t.message))]):e._e(),"card"==t.type&&"technique"==t.cardInfo.cardType?a("a-row",[e._v(e._s(t.message))]):e._e(),"report"==t.type?a("a-row",[e._v(e._s(t.message))]):e._e()],1)],1):e._e()],1)]):e._e()})),0),a("a-row",[a("a-col",{attrs:{span:20}},[a("a-textarea",{staticStyle:{"margin-top":"20px",height:"100px"},attrs:{placeholder:"请输入回复，shift+回车换行","auto-size":{minRows:2,maxRows:5}},nativeOn:{keydown:function(t){return e.handleKeyCode(t)}},model:{value:e.reply,callback:function(t){e.reply=t},expression:"reply"}})],1),a("a-col",{attrs:{span:4}},[a("a-button",{staticStyle:{"margin-left":"20px","margin-top":"50px",width:"100px"},attrs:{type:"primary",size:"large"},on:{click:function(t){return e.handleSubmit(e.selectData)}}},[e._v("发送")])],1)],1)],1)],1)])]}},{key:"expandedRowRender",fn:function(t,s){return[a("p",[e._v(e._s(t.description))])]}}])})],1)},n=[],r=a("c7eb"),o=a("1da1"),i=(a("b0c0"),a("14d9"),a("b775")),c=a("7424"),l=function(){var e="".concat(c["BASE_URL_IP"],"/api/system_chat/getAll");return Object(i["f"])(e,i["a"].GET)},d=function(e){var t="".concat(c["BASE_URL_IP"],"/api/system_chat/pushAdmin");return Object(i["f"])(t,i["a"].POST,e)},m=a("cadb"),p=[{title:"姓名",dataIndex:"name",scopedSlots:{customRender:"name"},width:"15%"},{title:"邮箱",dataIndex:"email",scopedSlots:{customRender:"email"},width:"20%"},{title:"时间",dataIndex:"time",scopedSlots:{customRender:"time"},width:"20%"},{title:"最新消息",dataIndex:"message",scopedSlots:{customRender:"message"},width:"30%"},{title:"操作",dataIndex:"operation",scopedSlots:{customRender:"operation"},render:function(){return h("a",["回复"])}}],u={name:"systemChatList",inject:["reload"],components:{},data:function(){return{data:[],columns:p,showDetail:!1,reply:"",selectData:{},style:{contentH:0,itemH:0}}},mounted:function(){var e=this;this.init(),this.pageToBottom(),this.timer=setInterval((function(){e.loadAllChat();for(var t=0;t<e.data.length;t++)e.data[t].uId==e.selectData.uId&&(e.selectData=e.data[t])}),5e3)},beforeDestroy:function(){clearInterval(this.timer)},onload:function(){this.init()},updated:function(){this.pageToBottom()},methods:{init:function(){var e=Object(o["a"])(Object(r["a"])().mark((function e(){return Object(r["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:this.loadAllChat();case 1:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),initdata:function(){var e=this;return Object(o["a"])(Object(r["a"])().mark((function t(){var a,s;return Object(r["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:try{a=window.innerHeight,s=200,e.style.contentH=a-2*s}catch(n){}case 1:case"end":return t.stop()}}),t)})))()},pageToBottom:function(){},loadAllChat:function(){var e=this;l().then((function(t){e.data=[];for(var a=0;a<t.data.system_chat_list.length;a++){var s=t.data.system_chat_list[a],n={messages:[]};n.uId=s.userInfo.uId,n.email=s.userInfo.email,n.name=s.userInfo.name;for(var r=null,o=null,i=0;i<s.messages.length;i++){var c=s.messages[i],l={};l.isme=c.isme,l.userpic=c.userpic,l.type=c.type,"report"===c.type?"WORK"===c.reportInfo.reportType?l.message="[成果报告卡片]主题是："+c.reportInfo.reportTitle+"\n详情请在移动端查看":"NEED"===c.reportInfo.reportType?l.message="[需求报告卡片]主题是："+c.reportInfo.reportTitle+"\n详情请在移动端查看":"ORDER"===c.reportInfo.reportType&&(l.message="[订单报告卡片]主题是："+c.reportInfo.reportTitle+"\n详情请在移动端查看"):(l.message=c.message,""===l.message&&(l.message="[空]")),l.cardInfo=c.cardInfo,l.created_at=c.created_at,null===r?(l.gstime=m["a"].gettime(c.created_at,0),r=c.created_at):(l.gstime=m["a"].gettime(c.created_at,r),r=c.created_at),n.messages.push(l),o=l.message}n.time=r,n.message=o,e.data.push(n)}})).catch((function(e){}))},handleSubmit:function(e){var t=this,a=this.reply;d({uId:this.selectData.uId,content:this.reply}).then((function(e){var s=(new Date).getTime(),n={isme:!0,userpic:"",type:"text",message:a,gstime:m["a"].gettime(s,t.selectData.messages[t.selectData.messages.length-1].created_at),created_at:s};t.selectData.messages.push(n)})).catch((function(e){})),this.reply=""},showSystemChat:function(e){this.showDetail=!0,this.selectData=e},handleKeyCode:function(e){13==e.keyCode&&(e.shiftKey?(this.reply=this.reply+"\n",e.preventDefault()):(e.preventDefault(),this.handleSubmit(this.reply)))}}},f=u,y=(a("e3ae"),a("2877")),_=Object(y["a"])(f,s,n,!1,null,null,null);t["default"]=_.exports},a401:function(e,t,a){},e3ae:function(e,t,a){"use strict";a("a401")}}]);